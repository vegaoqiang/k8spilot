---

- name: Copy Calico Offline Images To Remote Host
  ansible.builtin.copy:
    src: "{{ image_path }}/calico/{{ calico_version }}/{{ arch_alias }}"
    dest: "/tmp/calico"
    mode: '0644'
  delegate_to: "{{ item }}"
  loop: "{{ groups['worker'] }}"

- name: Load Calico Images
  ansible.builtin.shell: |
    find /tmp/calico/ -name "*.tar"|xargs -n 1 ctr -n k8s.io i import
  delegate_to: "{{ item }}"
  loop: "{{ groups['worker'] }}"
  async: 3600
  poll: 0 